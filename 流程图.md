# BFRM系统流程图

## 整体工作流程

```mermaid
graph TD
    subgraph 实验
        Z[气泡流实验流场] --> 高速成像技术
        高速成像技术 --> 内存/存储
        内存/存储 --> bubbly_flow.mp4
    end

    subgraph 数据加载与预处理
        bubbly_flow.mp4 --> A1[加载气泡流视频]
        bubbly_flow.mp4 --> A11[帧信息（origin_frame）]
        A1 --> B1[视频预处理]
    end

    subgraph 后续优化
        A2[针对气泡流特征] --> B2[BubSort多目标追踪]
    end
    
    subgraph 检测与追踪阶段:bubble_csv
        B1 --> C[YOLOv11气泡检测（main.py）]
        C --> D[多目标追踪]
        B2 --> D[多目标追踪（BotSort）]
        D --> E[生成检测&追踪结果（bubble_csv）]
        D --> F[生成可视化追踪视频（detection_with_tracks.mp4）]
    end
    
    subgraph 分析阶段:analysis_results
        E --> G[检测与追踪结果分析（bubble_analysis.py）]
        G --> I[气泡特性分析及可视化（visualizations）]
        G --> J[气泡区域提取（bubble_crops）]
        J --> J1[横向存储（Frame）]
        J --> J2[纵向存储（ID）]
        J1 --> J11[动力学信息]
        J2 --> J21[时序信息]
        J --> J3[类别存储（Classification）]
    end
    
    subgraph 三维重建:visualizations_3D&bubble_info
        E --> E1[气泡遮挡关系检测]
        E --> E2[单气泡单视角三维重建（大模型+3DBubbles数据集）]
        E1 --> L[三维流场初始化（第一帧，reconstruction3d.py）]
        E2 --> L[三维流场初始化（第一帧，reconstruction3d.py）]
        L --> M[流场三维结构更新（dynamic_reconstruction.py）]
        E --> M
    end
    
    subgraph 三维可视化:visualizations_3D
        M --> N[气泡流动态三维重建可视化（visualization_video.py）]
    end

    subgraph 在线分析与预测 未来计划
        N --> O[气泡流在线测量]
        O --> P[气泡流动态预测]
        O --> Q[气泡流超视野]
        J11 --> Q
        J21 --> P
    end
    
    style A2 fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style B2 fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style E2 fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style J11 fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style J21 fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style O fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style P fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style Q fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
    style Z fill:#9ED49D,stroke:#333,stroke-dasharray: 5 5
```

## 文件存储结构

```mermaid
graph LR
    A[BFRM项目根目录] --> B[原始视频文件]
    A --> C[bubble_csv]
    A --> D[detection_with_tracks.mp4]
    A --> E[analysis_results]
    A --> F[bubble_info]
    A --> G[visualizations]
    
    C --> C1[frame_0001.csv]
    C --> C2[frame_0002.csv]
    C --> C3[...]
    
    E --> E1[visualizations]
    E --> E2[bubble_crops]
    E --> E3[bubble_count_animation.mp4]
    E --> E4[bubble_count_plot.png]
    E --> E5[bubble_statistics.csv]
    
    E1 --> E11[detection_results]
    E1 --> E12[trajectories]
    
    E11 --> E111[detection_results.mp4]
    E11 --> E112[frame_0001.png]
    E11 --> E113[frame_0002.png]
    E11 --> E114[...]
    
    E12 --> E121[bubble_trajectories.mp4]
    E12 --> E122[frame_0001.png]
    E12 --> E123[frame_0002.png]
    E12 --> E124[...]
    
    E2 --> E21[bubble_id（按气泡ID组织）]
    E2 --> E22[frame_id（按帧号组织）]
    E2 --> E23[classification（按气泡类别组织）]

    E23 --> E231[single（按气泡类别组织）]
    E23 --> E232[overlap（按气泡类别组织）]

    E231 --> E2311[bubble_0001]
    E231 --> E2312[...]

    E2311 --> E23111[bubble_info.csv]
    E2311 --> E23112[frame_0001.png]
    E2311 --> E23113[...]
    
    E232 --> E2321[bubble_0001]
    E232 --> E2322[...]

    E2321 --> E23211[bubble_info.cs**v**]
    E2321 --> E23212[frame_0001.png]
    E2321 --> E23213[...]

    E23 --> E231[frame_0001_bubble_0001.png]
    E23 --> E232[frame_0001_bubble_0002.png]
    E23 --> E233[...]
    
    E24 --> E241[frame_0001_bubble_0028.png]
    E24 --> E242[frame_0001_bubble_0031.png]
    E24 --> E243[...]

    E3 --> E31[气泡数量实时监控]
    E4 --> E41[气泡信息数量统计]
    E5 --> E51[气泡信息数量统计]

    F --> F1[frame_0001_3d.csv]
    F --> F2[frame_0002_3d.csv]
    F --> F3[...]
    F --> F4[frame_XXXX_bubble_info.json]
    
    G --> G1[3d_bubbles.stl]
    G --> G2[3d_visualization.png]
    G --> G3[3d_front_view.png]
    G --> G4[3d_side_view.png]
    G --> G5[3d_top_view.png]
    G1 --> G2
    G1 --> G3
    G1 --> G4
    G1 --> G5

    G --> G6[density_estimation.png]
    G --> G7[气泡流场可视化.html]

    style F fill:#cfc,stroke:#333
    style G fill:#cfc,stroke:#333
```

## 图例说明

- <span style="color:#222222">■</span> 已完成功能
- <span style="color:#cfc">■</span> 部分完成功能
- <span style="color:#fcf">■</span> 未完成功能（计划中）
- <span style="color:#333; text-decoration:dashed">- - -</span> 开发中功能
